function startCountdown(e,t){let s,r,i=e;const n=setInterval((function(){s=parseInt(i/60,10),r=parseInt(i%60,10),s=s<10?"0"+s:s,r=r<10?"0"+r:r,t.textContent=s+":"+r,--i<0&&(clearInterval(n),alert("Time's up!"))}),1e3)}function showSpinner(e,t=!1){const s=e instanceof HTMLElement?e:document.querySelector(e);if(!s)return;const r=document.createElement("img"),i=t?smliser_var.wp_spinner_gif_2x:smliser_var.wp_spinner_gif;return r.src=i,r.id="smliser-spinner-image",s.querySelector("#smliser-spinner-image")?.remove(),s.appendChild(r),document.body.style.setProperty("cursor","progress"),r}function removeSpinner(e){e?.remove(),document.body.style.removeProperty("cursor")}function smliserNotify(e,t){const s=document.createElement("div");s.classList.add("notification"),s.innerHTML=`\n        <div class="notification-content">\n            <span id="remove" onclick="this.parentElement.parentElement.remove()">&times;</span>\n            <p>${e}</p>\n        </div>\n    `,s.style.position="fixed",s.style.top="40px",s.style.left="50%",s.style.width="30%",s.style.fontWeight="bold",s.style.transform="translateX(-50%)",s.style.padding="15px",s.style.backgroundColor="#fff",s.style.color="#333",s.style.border="1px solid #ccc",s.style.borderRadius="9px",s.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.5)",s.style.zIndex="9999",s.style.textAlign="center",document.body.appendChild(s),t&&setTimeout((()=>{s.remove()}),t)}function smliserCopyToClipboard(e){navigator.clipboard.writeText(e).then((()=>{smliserNotify("Copied to clipboard: ",3e3)})).catch((e=>{}))}const StringUtils={ucfirst:function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""},ucwords:function(e){return e?e.toLowerCase().split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "):""},decodeEntity:function(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value},escHtml:e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML.replace(/"/g,"&quot;")},formatCurrency:function(e,t){const{symbol:s="$",symbol_position:r="left",decimals:i=2,decimal_separator:n=".",thousand_separator:a=","}=t||{},o=e<0;let l=Math.abs(e).toFixed(i).replace(/\B(?=(\d{3})+(?!\d))/g,a).replace(".",n);const c=StringUtils.decodeEntity(s);switch(r){case"left":l=c+l;break;case"left_space":l=c+" "+l;break;case"right":l+=c;break;case"right_space":l=l+" "+c;break}return o?"-"+l:l}};document.addEventListener("DOMContentLoaded",(function(){let e=document.getElementById("smliserDownloadTokenBtn"),t=document.querySelectorAll(".smliser-key-div"),s=document.getElementById("smliser-search"),r=document.querySelectorAll(".smliser-form-description, .smliser-tooltip"),i=document.getElementById("smliser-license-delete-button"),n=document.querySelector("#smliser-update-btn"),a=document.querySelector("#smliser-plugin-delete-button"),o=document.querySelector("#smliser-select-all"),l=document.getElementById("smliser-admin-dasboard-wrapper"),c=document.getElementById("smliser-api-key-generation-form"),d=document.querySelectorAll(".smliser-revoke-btn"),m=document.querySelector(".smliser-monetization-ui"),u=document.querySelectorAll("form.smliser-options-form");const p=document.querySelector("form.smliser-compose-message-container");if(u&&u.forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(e.target),s=smliser_var.smliser_ajax_url;t.set("security",smliser_var.nonce);const r=e.target.querySelector('button[type="submit"]');r?.setAttribute("disabled",!0);const i=showSpinner(".smliser-spinner",!0);fetch(s,{method:"POST",body:t,credentials:"same-origin"}).then((async e=>{const t=e.headers.get("content-type");if(!e.ok){let s=await e.text();if(t.includes("application/json")){s=(await e.json())?.data?.message??s}throw new Error(s)}const s=await e.json();if(!s.success){throw new Error(s?.data?.message??"An error occurred")}smliserNotify(e?.data?.message??"Success",5e3)})).catch((e=>{e.message?.toLowerCase().includes("network")||e.message?.toLowerCase().includes("failed to fetch")?smliserNotify("Check network connection",5e3):smliserNotify(e.message,5e3)})).finally((()=>{removeSpinner(i),r?.removeAttribute("disabled")}))}))})),i&&i.addEventListener("click",(function(e){confirm("You are about to delete this license, be careful action cannot be reversed")||e.preventDefault()})),e){document.querySelector(".smliser-loader-container");let t=e.getAttribute("data-license-key"),s=e.getAttribute("data-item-id"),r=e.getAttribute("data-plugin-name"),i=document.getElementById("ajaxContentContainer"),n=document.createElement("div");n.classList.add("smliser-gen-token-form-container");let a=`\n        <div class="smliser-token-body" id="smliser-token-body">\n            <span id="remove">&times;</span>\n            <h2>Generate Download Token</h2>\n            <hr>\n\n            <span class="smliser-loader" style="display: none; color:#000000;" id="spinner"></span>\n        \n            <p>The token will be valid to download "<strong>${r}</strong>", token will expire in 10 days if no expiry date is selected</p>\n            <div id="smliserNewToken"></div>\n            <div class="smliser-token-expiry-field" id="formBody">\n                <label for="expiryDate">Choose Expiry Date</label>\n                <input type="datetime-Local" id="expiryDate" />\n                <input type="hidden" id="pop-up-license-key" name="license_key" value="${t}"/>\n                <input type="hidden" id="popup-item-id" name="item_id" value="${s}"/>\n            </div>\n            <button id="createToken" class="button action smliser-nav-btn">generate token</button>\n        </div>`;n.innerHTML=a,jQuery(i).hide(),i.appendChild(n),e.addEventListener("click",(e=>{e.preventDefault(),jQuery(i).fadeIn()}));let o=document.getElementById("remove"),l=document.getElementById("createToken"),c=()=>{jQuery(i).fadeOut()};o.addEventListener("click",c),l.addEventListener("click",(e=>{e.preventDefault();let t=document.getElementById("spinner"),s=document.getElementById("expiryDate").value,r=document.getElementById("pop-up-license-key").value,i=document.getElementById("popup-item-id").value;t.setAttribute("style","display: block; border: 5px dotted #000"),s||(s="");let n=new URL(smliser_var.smliser_ajax_url),a=new FormData;a.set("action","smliser_generate_item_token"),a.set("security",smliser_var.nonce),a.set("expiry",s),a.set("license_key",r),a.set("item_id",i),fetch(n,{method:"POST",body:a}).then((e=>{if(!e.ok)throw new Error(e.statusText);return e.json()})).then((e=>{if(e.success){downloadToken=e.data.token;var t=document.createElement("div");t.classList.add("smliser-token-body"),t.classList.add("added");let s=`<p><strong>New token:</strong> ${downloadToken} <span class="dashicons dashicons-admin-page"></span></p>`;s+="<p><strong>Note:</strong> This is the last time this token will be revealed. Please copy and save it securely.</p>",t.innerHTML=s,jQuery("#smliserNewToken").html(t),document.getElementById("formBody").remove(),l.remove(),t.querySelector("span.dashicons").addEventListener("click",(()=>{smliserCopyToClipboard(downloadToken)}))}else{smliserNotify(e.data&&e.data.message?e.data.message:"An error occurred",5e3)}})).catch((e=>{smliserNotify(e.message||"An unexpected error occurred",5e3)})).finally((()=>{t.setAttribute("style","display: none;")}))}))}if(t.length&&t.forEach((e=>{const t=e.querySelector(".smliser-license-key-field"),s=e.querySelector(".smliser-show-license-key"),r=e.querySelector(".smliser-visible-license-key"),i=e.querySelector(".smliser-partially-hidden-license-key-container"),n=e.querySelector(".smliser-to-copy");s&&(s.addEventListener("change",(function(){this.checked?(jQuery(r).fadeIn().css("display","block"),i.style.display="none"):(r.style.display="none",jQuery(i).fadeIn().css("display","block"))})),n.addEventListener("click",(function(e){e.preventDefault(),navigator.clipboard.writeText(t.value).then((function(){smliserNotify("copied",2e3)})).catch((function(e){smliserNotify(e,2e3)}))})))})),s){let e=document.querySelectorAll(".smliser-table tbody tr"),t=document.querySelector(".smliser-table tbody");s.addEventListener("input",(function(){const r=s.value.toLowerCase();let i=!0;if(e.forEach((function(e){const t=e.querySelector("td:nth-child(2)").textContent.toLowerCase(),s=e.querySelector("td:nth-child(3)").textContent.toLowerCase(),n=e.querySelector("td:nth-child(4)").textContent.toLowerCase(),a=e.querySelector("td:nth-child(5)").textContent.toLowerCase(),o=e.querySelector("td:nth-child(6)").textContent.toLowerCase(),l=e.querySelector("td:nth-child(7)").textContent.toLowerCase();t.includes(r)||s.includes(r)||n.includes(r)||a.includes(r)||o.includes(r)||l.includes(r)?(e.style.display="",i=!1):e.style.display="none"})),i){if(!document.querySelector(".smliser-not-found")){const e=document.createElement("tr");e.className="smliser-not-found",e.innerHTML='<td colspan="7">No results found</td>',t.appendChild(e)}}else{const e=document.querySelector(".smliser-not-found");e&&e.remove()}}))}if(r.length&&r.forEach((function(e){e.addEventListener("mouseenter",(function(){var e=this.getAttribute("title");if(e){this.setAttribute("data-title",e),this.removeAttribute("title");var t=document.createElement("div");t.className="custom-tooltip",t.innerText=e,document.body.appendChild(t);var s=this.getBoundingClientRect();t.style.top=s.top+window.scrollY-t.offsetHeight-5+"px",t.style.left=s.left+window.scrollX+s.width/2-t.offsetWidth/2+"px",t.classList.add("show"),this._tooltipElement=t}})),e.addEventListener("mouseleave",(function(){var e=this._tooltipElement;e&&(e.classList.remove("show"),setTimeout((function(){document.body.removeChild(e)}),300),this.setAttribute("title",this.getAttribute("data-title")),this.removeAttribute("data-title"),this._tooltipElement=null)}))})),n){let e=document.querySelector("#smliser-click-notice");n.addEventListener("click",(t=>{t.preventDefault(),n.parentElement.style.display="none",e.style.display="block";let s=document.createElement("span");s.classList.add("dashicons","dashicons-dismiss"),s.style.color="red",s.style.float="right",s.addEventListener("click",(()=>{s.parentElement.parentElement.remove()})),e.appendChild(s);let r=new URL(smliser_var.smliser_ajax_url);r.searchParams.set("action","smliser_upgrade"),r.searchParams.set("security",smliser_var.nonce),fetch(r).then((e=>{if(!e.ok)throw new Error(e.statusText);return e.json()})).then((t=>{t.success?(smliserNotify(t.data.message||"Upgrade successful!",5e3),n.parentElement.style.display="none",e.style.display="block"):smliserNotify(t.data?.message||"An error occurred",5e3)})).catch((e=>{smliserNotify(e.message||"An unexpected error occurred",5e3)}))}))}if(a&&a.addEventListener("click",(e=>{if(!confirm("You are about to delete this plugin from the repository, this action cannot be reversed!"))return void e.preventDefault();let t=new URL(smliser_var.smliser_ajax_url);t.searchParams.set("action","smliser_plugin_action"),t.searchParams.set("real_action","delete"),t.searchParams.set("item_id",a.getAttribute("item-id")),t.searchParams.set("security",smliser_var.nonce),fetch(t).then((e=>(e.ok||smliserNotify(`Error: [${e.status}] ${e.statusText}`),e.json()))).then((e=>{e.success?(smliserNotify(`Success: ${e.data.message}`,3e3),setTimeout((()=>{window.location.href=e.data.redirect_url}),3e3)):smliserNotify(`Error: ${e.data.message}`,6e3)}))})),o){let e=document.querySelectorAll(".smliser-license-checkbox, .smliser-checkbox");o.addEventListener("change",(function(){e.forEach((e=>{e.checked=o.checked}))})),e.forEach((t=>{t.addEventListener("change",(function(){o.checked=Array.from(e).every((e=>e.checked))}))}))}if(l){var y=document.getElementById("pluginUpdateChart").getContext("2d"),f=document.getElementById("licenseActivationChart").getContext("2d"),h=document.getElementById("licenseDeactivationChart").getContext("2d");new Chart(y,{type:"bar",data:{labels:["Hits","Visits Today","Unique Visitors","Plugin Downloads Served"],datasets:[{label:"Plugin Update Route",data:[smliserStats.pluginUpdateHits,smliserStats.pluginUpdateVisits,smliserStats.pluginUniqueVisitors,smliserStats.pluginDownloads],backgroundColor:["#36a2eb","#ff6384","#ff0000","#16f2b0"]}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}}),new Chart(f,{type:"bar",data:{labels:["Hits","Visits Today","Unique Visitors"],datasets:[{label:"License Activation Route",data:[smliserStats.licenseActivationHits,smliserStats.licenseActivationVisits,smliserStats.licenseActivationUniqueVisitors],backgroundColor:["#36a2eb","#ff6384","#ff0000"]}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}}),new Chart(h,{type:"bar",data:{labels:["Hits","Visits Today","Unique Visitors"],datasets:[{label:"License Deactivation Route",data:[smliserStats.licenseDeactivationHits,smliserStats.licenseDeactivationVisits,smliserStats.licenseDeactivationUniqueVisitors],backgroundColor:["#36a2eb","#ff6384","#ff0000"]}]},options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}if(c){let e=document.querySelector(".spinner-overlay");c.addEventListener("submit",(t=>{t.preventDefault(),e.classList.add("show");let s=new FormData(c);s.append("action","smliser_key_generate"),s.append("security",smliser_var.nonce),fetch(smliser_var.smliser_ajax_url,{method:"POST",body:s}).then((e=>{if(!e.ok)throw new Error(e.statusText);return e.json()})).then((e=>{if(e.success){let r=e.data?e.data.consumer_public:"",i=e.data?e.data.consumer_secret:"",n=e.data?e.data.description:"";var t=document.createElement("div");t.style.border="1px solid #ccc",t.style.borderRadius="9px",t.style.padding="10px",t.style.margin="20px auto",t.style.backgroundColor="#fff",t.style.width="50%";var s='<h2 style="text-align:center;">API Credentials</h2>';s+="<p><strong>Description:</strong> "+n+"</p>",s+="<p><strong>Consumer Public:</strong> "+r+"  <span onclick=\"smliserCopyToClipboard('"+r+'\')" class="dashicons dashicons-admin-page"></span></p>',s+="<p><strong>Consumer Secret:</strong> "+i+"  <span onclick=\"smliserCopyToClipboard('"+i+'\')" class="dashicons dashicons-admin-page"></span></p>',s+="<p><strong>Note:</strong> This is the last time these credentials will be revealed. Please copy and save them securely.</p>",t.innerHTML=s,jQuery(t).hide(),jQuery(c).fadeOut("slow",(()=>{c.parentNode.insertBefore(t,c.nextSibling),jQuery(t).fadeIn("slow")}))}else{smliserNotify(e.data&&e.data.message?e.data.message:"An unknown error occurred.",3e3)}})).catch((e=>{})).finally((()=>{e.classList.remove("show"),c.reset()}))}))}if(d){let e=document.querySelector(".spinner-overlay");d.forEach((function(t){let s=t.getAttribute("data-key-id");t.addEventListener("click",(()=>{if(!confirm("You are about to revoke this license, connected app will not be able to access resource on this server, be careful action cannot be reversed"))return;e.classList.add("show");let t=new URL(smliser_var.smliser_ajax_url);t.searchParams.set("action","smliser_revoke_key"),t.searchParams.set("security",smliser_var.nonce),t.searchParams.set("api_key_id",s),fetch(t,{method:"GET"}).then((e=>{if(!e.ok)throw new Error(e.statusText);return e.json()})).then((e=>{if(e.success){smliserNotify(e.data?e.data.message:"",3e3),location.reload()}else{smliserNotify(e.data&&e.data.message?e.data.message:"An unknown error occurred.",3e3)}})).catch((e=>{})).finally((()=>{e.classList.remove("show")}))}))}))}if(m){let e=document.querySelector(".smliser-admin-modal.pricing-tier"),t=document.querySelector("#tier-form");const s=e=>{if(!e.value.trim()){let t=e.getAttribute("field-name")||"This field";e.setCustomValidity(`${t} is required.`),e.addEventListener("input",r)}},r=e=>{e.target.setCustomValidity(""),e.target.removeEventListener("input",r)},i=(e,s)=>{const i=t.querySelector(`#${e}`);i&&(i.setCustomValidity(s),i.reportValidity(),i.addEventListener("input",r))},n=async(e,t={})=>{const s=await fetch(e,t);if(!s.ok){const e=s.headers.get("content-type");let t="An error occurred",r=null;if(e&&e.includes("application/json")){const e=await s.json();throw t=e.data?.message||t,r=e.data?.field_id||null,{message:t,field:r}}throw{message:await s.text()||t}}return s.json()},a=e=>{if(e.preventDefault(),t.querySelectorAll("#tier_name, #product_id, #billing_cycle, #provider_id, #features").forEach(s),!t.checkValidity())return void t.reportValidity();const r=new FormData(t);r.set("security",smliser_var.nonce),n(smliser_var.smliser_ajax_url,{method:"POST",body:r}).then((e=>{if(e.success)smliserNotify(e.data?.message||"Operation successful",3e3),setTimeout((()=>window.location.reload()),3e3);else{let t=e.data?.message||"An unknown error occurred.",s=e.data?.field_id||null;s&&i(s,t),smliserNotify(t,6e3)}})).catch((e=>{e.field&&i(e.field,e.message),smliserNotify(e.message||"An unexpected error occurred",6e3)}))},o={addNewTier:()=>{e.classList.remove("hidden"),t.querySelectorAll("input, select, textarea").forEach((e=>{"action"===e.name&&(e.value="smliser_save_monetization_tier"),"hidden"!==e.type&&(e.value="")}))},editTier:s=>{let r=JSON.parse(s);e.classList.remove("hidden"),t.querySelector('input[name="action"]').value="smliser_save_monetization_tier",t.querySelector('input[name="tier_id"]').value=r.id||"",t.querySelector("#tier_name").value=r.name||"",t.querySelector("#product_id").value=r.product_id||"",t.querySelector("#billing_cycle").value=r.billing_cycle||"",t.querySelector("#provider_id").value=r.provider_id||"",t.querySelector("#max_sites").value=r.max_sites||"",t.querySelector("#features").value=Array.isArray(r.features)?r.features.join(", "):r.features||""},deleteTier:e=>{let t=JSON.parse(e);if(confirm(`Are you sure you want to delete tier "${t.name}"?`)){const e=new FormData;e.set("action","smliser_delete_monetization_tier"),e.set("security",smliser_var.nonce),e.set("monetization_id",t.monetization_id),e.set("tier_id",t.id),n(smliser_var.smliser_ajax_url,{method:"POST",body:e}).then((e=>{e.success?(smliserNotify(e.data?.message||"Tier deleted",3e3),setTimeout((()=>window.location.reload()),2e3)):smliserNotify(e.data?.message||"Delete failed",6e3)})).catch((e=>smliserNotify(e.message||"Delete failed",6e3)))}},closeModal:()=>{e.classList.add("hidden")},viewProductData:e=>{let t=JSON.parse(e);m.querySelector(".smliser-admin-modal.product-data")?.remove();let s=document.createElement("div");s.className="smliser-admin-modal product-data",s.innerHTML=`\n                    <div class="smliser-admin-modal_content">\n                        <span class="dashicons dashicons-dismiss remove-button" title="remove" data-command="closeModal"></span>\n                        <h2 class="product-data-header">\n                            <span class="product-image-slot"></span>\n                            <span class="product-title">Product Data for: ${t.name||""}</span>\n                        </h2>\n                        <table class="widefat striped">\n                            <tbody>\n                                <tr><th scope="row">Product ID</th><td>${t.product_id}</td></tr>\n                                <tr><th scope="row">Provider</th><td>${t.provider_id}</td></tr>\n                                <tr><th scope="row">Billing Cycle</th><td>${t.billing_cycle}</td></tr>\n                                <tr><th scope="row">Price</th><td><span class="price-field">Loading...</span></td></tr>\n                                <tr><th scope="row">Description</th><td><span class="desc-field">Loading...</span></td></tr>\n                            </tbody>\n                        </table>\n                        <div class="spinner-overlay show">\n                            <img src="${smliser_var.admin_url}images/spinner.gif" alt="Loading..." class="spinner-img">\n                        </div>\n                    </div>\n                `,m.appendChild(s),s.querySelector(".remove-button").addEventListener("click",(()=>s.remove())),s.addEventListener("click",(e=>{e.target.classList.contains("smliser-admin-modal")&&s.remove()}));const r=new URLSearchParams({action:"smliser_get_product_data",security:smliser_var.nonce,provider_id:t.provider_id,product_id:t.product_id});n(`${smliser_var.smliser_ajax_url}?${r.toString()}`,{method:"GET"}).then((e=>{if(s.querySelector(".spinner-overlay")?.remove(),!e.success)return void smliserNotify(e.data?.message||"Could not fetch product data",6e3);const t=e.data.product||{},r=t.pricing||{};if(t.images&&t.images.length>0){const e=document.createElement("img");e.src=t.images[0].src,e.alt=t.images[0].alt||"Product Image",e.className="product-thumb",s.querySelector(".product-image-slot").appendChild(e)}let i="N/A";r.price&&(i=StringUtils.formatCurrency(r.price,t.currency)),s.querySelector(".price-field").textContent=i,s.querySelector(".desc-field").innerHTML=t.description||""})).catch((e=>{s.querySelector(".spinner-overlay")?.remove(),smliserNotify(e.message||"An unexpected error occurred",6e3)}))},toggleMonetization:(e,t)=>{const s=new FormData;s.set("action","smliser_toggle_monetization"),s.set("security",smliser_var.nonce),s.set("monetization_id",e),s.set("enabled",t),fetch(smliser_var.smliser_ajax_url,{method:"POST",body:s}).then((async e=>{if(!e.ok){const t=e.headers.get("content-type");let s="An error occurred";if(t&&t.includes("application/json")){throw s=(await e.json()).data?.message||s,new Error(s)}{const t=await e.text();throw new Error(t||s)}}return e.json()})).then((e=>{e.success?smliserNotify(e.data?.message||"Monetization updated",3e3):smliserNotify(e.data?.message||"Update failed",6e3)})).catch((e=>{smliserNotify(e.message||"An unexpected error occurred",6e3)}))}};m.addEventListener("click",(e=>{if(e.target.classList.contains("smliser-admin-modal"))return e.preventDefault(),void o.closeModal();const t=e.target.closest("#add-pricing-tier, .remove-modal");if(t){e.preventDefault();const s=t.getAttribute("data-command");return void o[s]?.()}const s=e.target.closest(".smliser-tier-edit, .smliser-tier-delete, .smliser-tier-view");if(s){e.preventDefault();const t=s.getAttribute("data-action"),r=s.closest(".smliser-pricing-tier-info");o[t]?.(r.dataset.json)}})),m.addEventListener("change",(e=>{const t=e.target.closest(".smliser_toggle-switch-input");if(t&&"toggleMonetization"===t.dataset.action){const e=t.dataset.monetizationId,s=t.checked?1:0;o.toggleMonetization(e,s)}})),t.addEventListener("submit",a)}if(p){let e=p.querySelector("#smliser-app-select");tinymce.init({selector:"#message-body",skin:"oxide",branding:!1,license_key:"gpl",menubar:"file insert table",plugins:"lists link image media table code preview fullscreen autosave searchreplace visualblocks insertdatetime emoticons",toolbar:"add_media_button | styles | alignleft aligncenter alignjustify alignright bullist numlist outdent indent | forecolor backcolor | code fullscreen preview | undo redo",height:600,relative_urls:!1,remove_script_host:!1,promotion:!1,valid_children:"+div[div|span],+span[span|div]",font_formats:"Inter=Inter, sans-serif; Arial=Arial, Helvetica, sans-serif; Verdana=Verdana, Geneva, sans-serif; Tahoma=Tahoma, Geneva, sans-serif; Trebuchet MS=Trebuchet MS, Helvetica, sans-serif; Times New Roman=Times New Roman, Times, serif; Georgia=Georgia, serif; Palatino Linotype=Palatino Linotype, Palatino, serif; Courier New=Courier New, Courier, monospace",toolbar_mode:"sliding",content_style:'body { font-family: "Inter", sans-serif; font-size: 16px; }'});const t=e=>({search:e.term}),s=e=>{const t={};e.apps.forEach((e=>{t[e.type]||(t[e.type]=[]),t[e.type].push({id:`${e.type}:${e.slug}`,text:e.name,type:e.type})}));return{results:Object.keys(t).map((e=>({text:e.charAt(0).toUpperCase()+e.slice(1),children:t[e]})))}};jQuery(e).select2({placeholder:"Search apps",ajax:{url:smliser_var.app_search_api,dataType:"json",delay:1e3,data:t,processResults:s,cache:!0},allowClear:!0,minimumInputLength:2});const r=e=>{e.target.setCustomValidity(""),e.target.removeEventListener("input",r)};p.addEventListener("submit",(async t=>{t.preventDefault();const s=tinymce.get("message-body");s?.save();const i=p.querySelector("#subject"),n=p.querySelector("#message-body");if(i.value.trim().length||(i.setCustomValidity("Message subject is required."),i.addEventListener("input",r)),!n.value.trim().length)return void s?.notificationManager.open({text:"Message body cannot be empty.",type:"error",timeout:5e3});if(!p.reportValidity())return;const a=new FormData(p);a.set("security",smliser_var.nonce),a.set("action","smliser_publish_bulk_message");const o=p.querySelector('button[type="submit"]'),l=showSpinner(o);o&&(o.disabled=!0);try{const t=await fetch(smliser_var.smliser_ajax_url,{method:"POST",body:a,credentials:"same-origin"}),r=t.headers.get("content-type"),i=r&&r.includes("application/json"),n=i?await t.json():await t.text();if(!t.ok){const e=i?n.data?.message||"An error occurred":n;throw new Error(e).type="SMLISER_NOT_OK",err}if(!n.success){const e=n.data?.message||"An unknown error occurred.",t=new Error(e);throw t.type="SMLISER_FAILURE",t}smliserNotify(n.data?.message||"Message sent successfully",5e3),p.reset(),jQuery(e).val(null).trigger("change"),s?.setContent(""),n.data?.redirect_url&&(window.location.href=n.data.redirect_url)}catch(e){e instanceof TypeError?smliserNotify("Network error or server is unreachable.",6e3):"SMLISER_NOT_OK"===e.type||"SMLISER_FAILURE"===e.type?smliserNotify(e.message,6e3):smliserNotify("An unexpected error occurred.",6e3)}finally{o&&(o.disabled=!1),removeSpinner(l)}}))}}));